## 取り組んだ課題一覧
- SQL超入門コース
## わかったこと
- 集計関数の特徴
    - 検索対象の全行を一まとめに扱い、1回だけ集計処理を行う
    - 集計関数の結果は必ず1行になる
    - 集計関数はSELECT文でのみ使用できる
- NULLをゼロとして集計したい場合はCOALESCE関数を使う

```
SELECT AVG(COALESCE(出金額, 0)) AS 出金額の平均
FROM 家計簿
```

- GROUP BYでグループ化できる

```
SELECT 費目, SUM(出金額) AS 費目別の出金額合計
FROM 家計簿
(WHERE もとの表に対する絞り込み条件)
GROUP BY 費目;
```

- 集計処理を行ったあとの結果表に対して絞り込みを行いたい場合は、WHERE句ではなくHAVING句を用いる

```
SELECT 費目, SUM(出金額) AS 費目別の出金額合計
FROM 家計簿
GROUP BY 費目
HAVING SUM(出金額) > 0;
```
- SELECT文に記述可能な部品

```
SELECT 選択列リスト
FROM テーブル名
WHERE 条件式
GROUP BY グループ化する列名
HAVING 集計結果に対する条件式
ORDER BY 並び替え列名
```

- 副問い合わせについて
- ほかのSQL文の一部分として登場するSELECT文のことを副問い合わせ、副照会、サブクエリという
- 副問い合わせの動作は内側にSELECT文が実行されて結果に化けた後外側のSQLが実行
- 副問い合わせの3つパターン
    - 単一の値の代わりとして副問い合わせの検索結果を用いる
    - 複数の値の代わりとして副問い合わせの検索結果を用いる
        - 複数行副問い合わせは複数の値に化けるので、単なる等号や不等号では比較できない
        - ANYやALLを組み合わせることで複数の値との比較ができる
        - `NOT IN` と`<>ALL`はすべての値と一致しないことを判定する演算子
        - `IN`と`=ANY`はいずれかの値と一致することを判定する演算子
        - `NOT IN` と`<>ALL`で判定する副問い合わせの結果にNULLを含んでいると全体の結果もNULLになる
    - 表の値の代わりとして副問い合わせの検索結果を用いる
- 副問い合わせの結果からNULLを除外する
    - 副問い合わせの絞り込み条件に`IS NOT NULL`を含める
    - COALEASCE関数を使ってNULLを別の値に置き換える

    ```
    SELECT * FROM 家計簿アーカイブ
    WHERE 費目 IN ( SELECT 費目 FROM 家計簿 WHERE 費目 IS NOT NULL )

    SELECT * FROM 家計簿アーカイブ
    WHERE 費目 IN ( SELECT COALESCE(費目, '不明') FROM 家計簿 ) 
    ```
- FROM句で副問い合わせを利用する

```
SELECT SUM(SUB.出金額) AS 出金額合計
FROM (SELECT 日付, 費目, 出金額
        FROM 家計簿
        UNION
        SELECT 日付, 費目, 出金額
        FROM 家計簿アーカイブ
        WHERE 日付 >= '2018-01-01'
        AND 日付 >= '2018-01-31') AS SUB
```

- INSERT文で副問い合わせを利用

副問い合わせがVALUES以降の記述に相当する内容へ化ける。
```
INSERT INTO 家計簿集計 (費目, 合計, 平均, 回数)
SELECT 費目, SUM(出金額), AVG(出金額), 0
FROM 家計簿
WHERE 出金額 > 0
GROUP BY 費目
```
## 次やること
- スッキリわかるSQL入門 第3版 ドリル256問付き! (スッキリわかる入門シリーズ)
## 感じたこと
- 副問い合わせをINSERT文で使用する使い方が勉強になりました。
## 学習時間
- 本日：2h00m
- 累計：224h15m
